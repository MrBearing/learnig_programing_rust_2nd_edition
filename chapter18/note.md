# 18章 入出力を読んでの覚書

バイト単位の入力・出力機能についての章。基本的にRead,Write,BufReadについての解説

## 18.1 readerとwriter
- 冒頭のコード試してみたい
  - 読み終わってから実験する。
- ```std::io::prelude::*```は常にインポート
  - Read,Bufread,Write,Seekを含んだモジュール
- ```std::io::self```もインポートする。```io::Error```等の書き方ができる様にするため(std::が省略できる)

### 18.1.1 Reader
- 与えた配列の長さ分読み込むのでバイト単位の読み込みも難しくない
- ただし、readを直接使うのはあまりよろしくない
- closeは存在しない。Dropを実装してるのでスコープから外れたら自動でCloseされる
### 18.1.2 バッファ付きreader
- read_line等の処理ができるReader
- read_untilは便利そう。字句解析みたいな場合にさくっと使える。

### 18.1.3 行の読み出し

- サンプルファイルが書かれているので、書いてみる
- stdin.lock()は面白い。実装はmutexでやってるのか？
- イテレータで書き直してみる

### 18.1.4 行に対するcollect

- read.lines()でcollect()を使える
  - ただし、正しい型指定をしなければならない。
- Resultに対するFromIteratorが実装されている
  - きちんと型の関係を読み解く必要が有る。
  - この辺は他の標準ライブラリ使った場合にもそうだと思うが。。

### 18.1.5 writer
- write!やwriteln!を使うと便利
- 直接writeメソッドを使用するのは推奨されない
- flushが用意されているので適宜使用
- バッファするBufWriterは用意されている
  - ドロップ時に書き出しされるが、エラーが発生しても無視される
  - エラーを確実に検知したければ、ドロップ前にflush()を呼び出してバッファの内容をWriterに書き出しする

### 18.1.6 ファイル
- オプション指定が色々有るので要注意

### 18.1.7 シーク

-コストが高いが、ファイル内の移動をしながら読み書きができる

### 18.1.8 他のreader型、writer型

- io::stdin(), io::stdout(), io::stderr()
  - .lock()メソッドでロックしてから書き込み/読み込みできる
- Vec<u8>
  - write を実装してるので、ベクタにデータを吐ける。
  - StringはWriteを実装していないので注意
- Cursor
  - 面白いが、使いどころ？？
- TCP
- std::process::Command
  - プロセス間通信の仕組み？
  - サンプルあるので試してみる
- io::sink(),io::empty()
  - 何もしないwriter , reader
- io::repeat(byte)
  - 繰り返しするだけ
  - テスト用には良いかも

### 18.1.9 バイナリデータ、圧縮、シリアライズ
- serdeの紹介
  - 以前のプロジェクトで使ったことあったので存在は知ってた
  - JSON以外も使えるけど、非常に使い勝手が良いので今後も多用したい
## 18.2 ファイルとディレクトリ
### 18.2.1 OsStrとPath
- サロゲート？なんだっけ
- OsStr : OSごとのややこしい文字処理をうまいことやってくるれるstr
  - OsStringというのも有る
- Path:パスを扱うトレイト
### 18.2.2 PathとPathBufのメソッド
- components面白い
- 
### 18.2.3 ファイルシステムアクセス関数
- いっぱい有るので完全に覚えなくても良いけど、適宜調べて使う
- "mkdir()"ってなんてるのなんで？

### 18.2.4 ディレクトリの読み出し
- ディレクトリの操作とか属性読み出し関係
- お世話になりそうな内容だから、避けづらいけどとりあえず斜め読み
### 18.2.5 プラットフォーム固有機能
- #[cfg(unix)],#[cfg(windows)],#[cfg(target_os = "macos")]等でOS指定の条件コンパイルができる
  - #define でマクロ地獄にならないのすごく好き
- プラットフォームに固有の機能はそれぞれクレートが別で提供されてるので、積極利用は避けるべき


## 18.3 ネットワークプログラム
- websocketクレートはちょっと古い。今はtungsteniteが活発になってる
- サンプルは書いてみよう
