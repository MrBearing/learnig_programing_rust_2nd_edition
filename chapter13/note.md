 
# 13章を読んでの覚書

- 表13.1は非常に便利
- 以下のトレイトに関しては対応する賞を読むこと
  - Iteratorトレイト,IntoIteratorトレイト->15章
  - Hashトレイト->16章
  - SendとSync->19章
- 
## 13.1 Drop

いわゆるデストラクタの動作をするトレイト

Q1. dropメソッドは誰が呼んでいるのか。(「システムが」等の曖昧な回答ではなく)

## 13.2 Sized

- イマイチよくわかってないdyn型。おそらくdynamicの略。動的に型付けしたいのかな？
- 11章のトレイトオブジェクトの章参照のこと
  - [ ] 参照して意味を理解した
- ファットポインタ?
  - [ ] 調べて以下に記述
- Sizedはデフォルト```struct SomeStruct<T>{}```と書くと```struct SomeStruct<T: Sized>{}```の意味
- ```struct SomeStruct<T: ?Sized>{}```はSizedではない可能性がある場合

## 13.3 Clone

- cloneできるトレイト
  - 値の移動ではない完全なclone
  - 例外RcやArcなどの参照カウントポインタ
- デフォルトで良いなら```#[derive(Clone)]```でcloneとclone_from両方実装してくれる
- cloneは失敗してはいけない
  - 失敗する可能性があるなら自前でtry_cloneとかを実装すべき
- [ ] デフォルトと自前実装両方でCloneトレイトを実装する練習


## 13.4 Copy

- マーカートレイト : std::marker::Copy
- 代入の際に値の移動が行われず、コピーされるトレイト
- Dropと併用不可
- 大抵、```#[derive(Clone,Copy)]```で事足りる

## 13.5 DerefとDerefMut

- \*や.の演算子の動作指定のポインタ
- **参照解決型変換(deref coercions)** : RcやBoxのようなDrefを実装しているトレイトに強制的に別の型として振る舞わせること。例えば```Rc<String>```に対して```(*r).find('?')```と書くところを```r.find('?')```の用に記述できる
  - 良し悪しがあるので使うかは判断必要
  - 初見殺しなところもあるので慣れが必要
  - たまにBoxが勝手に外れてるように見えるのはこれが有るからか
  - 混乱しやすい例を参照するとわかるが、この機能はあくまで方の不整合解決のため

## 13.6 Default

- 自明なデフォルト値を設定する際に使うトレイト
  - VecやHashmapなどのコレクションを実装するとき
- [ ] partitionの例をサンプル実行する
- 基本的に```#[derive(Default)]```で十分に解決できる

## 13.7 AsRefとAsMut

- as_ref関数のためのトレイト
- 参照解決型変換を使って、```&T```への変換をうまくやってくれる
- イマイチ理解できた気がしない。。。。
  - 参照関係の理解が曖昧だからか？
  - [ ] 理解が曖昧な参照のについてまとめた
- 基本的に重い処理は避けるべき
  - 重い処理があるならFromの実装を検討すべき
- あくまで参照なのでコピーしたりヒープ確保は良くない


## 13.8 BorrowとBorrowMut

- AsRefと定義一緒
- すべての&mut T型がBorrow<T>を実装するようになっている
- BorrowMutはBorrowの可変参照版

## 13.9 FromとInto

- ある型の値を消費して別の方を返す変換を表すトレイト
- 引数の**所有権を受け取り**、変換処理をして呼び出し元に変換結果の**所有権を返す**
- "標準ライブラリは自明な変換を自動的に実装してくれる"
  - 自動的に実装できる条件は？
- 基本的には作成した型Tに```From<SomeType>```を実装する形を取る
- ```From<SomeType>```が実装されていれば標準ライブラリが対応するIntoを生成してくれる
- 比較的重い処理やヒープ確保,コピー等を行って良い
- Errorトレイトは好例
  - Errorを実装したすべての型に```Box<dyn Error + Send + Sync + `a>```への変換が定義されている
- 変換の失敗は基本的に許されない

## 13.10 TryFromとTryInto

- i64 からi32への変換のように、情報が欠落する可能性のある変換を定義する
- Resultが返るので、変換の失敗はErrorが使える
- FromとIntoの関係と同じで、TryFromを実装すればTryIntoは自動実装される

From・TryFroｍを実装すれば自動的にInto・TryIntoは実装される

## 13.11 ToOwned

- 参照が与えられて参照先の所有可能なコピーを作りたい場合に実装する
  - Cloneだと```&T```をクローンすると```T```が返るため```&[i32]```等を返せない
  - [ ] 真偽確認：unsizedなものは関数で返せない？


```&[i32]``` -> ```[u8]```になってるのなぜ？


## 13.12 BorrowとToOwnedの動作例 : つつましいCow

- Cow面白い
- [ ] 理解ができていない部分がある・再読とサンプルコードの実行